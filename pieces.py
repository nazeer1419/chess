from OpenGL.GL import *
from OpenGL.GLU import *

from config import Config
from point import Point

class Piece:
    def __init__(self, piece_name:str, player:str, position:Point, row:int, column:int):
        self.piece_name:str = piece_name.upper()
        self.player:str = player
        self.position:Point = position
        self.moved:bool = False
        self.pawn_double_move = False
        self.pawn_can_en_passant = False
        self.row:int = row
        self.column:int = column

        if player == '1':
            self.primary_color:tuple[float, float, float] = Config.PLAYER_1_PRIMARY_COLOR
            self.secondary_color:tuple[float, float, float] = Config.PLAYER_1_SECONDARY_COLOR
        elif player == '2':
            self.primary_color:tuple[float, float, float] = Config.PLAYER_2_PRIMARY_COLOR
            self.secondary_color:tuple[float, float, float] = Config.PLAYER_2_SECONDARY_COLOR
        else:
            self.primary_color:tuple[float, float, float] = (1, 0, 0)
            self.secondary_color:tuple[float, float, float] = (1, 1, 1)

    def draw(self):
        # get scale
        SCALE = Config.SCALE

        piece_mapping:list = Piece._get_piece(self.piece_name)

        start_position = self.position.clone()

        for row in piece_mapping:
            # reset position
            start_position.x = self.position.x

            for pixel in row:
                pixel:str

                if pixel == '0':
                    # skip pixel
                    pass
                else:
                    if pixel == '1':
                        color = self.primary_color
                    elif pixel == '2':
                        color = self.secondary_color
                    else:
                        color = (1, 0, 0)

                    # calculate points
                    P1 = start_position.clone()
                    P2 = Point(start_position.x + SCALE, start_position.y)
                    P3 = Point(start_position.x + SCALE, start_position.y - SCALE)
                    P4 = Point(start_position.x, start_position.y - SCALE)

                    # draw pixel
                    glBegin(GL_QUADS)

                    glColor3f(*color)

                    glVertex2f(P1.x, P1.y)
                    glVertex2f(P2.x, P2.y)
                    glVertex2f(P3.x, P3.y)
                    glVertex2f(P4.x, P4.y)

                    glEnd()

                # update x
                start_position.x += SCALE

            # update y
            start_position.y -= SCALE
                    
    def _get_piece(piece_name:str) -> list:
        piece_name = piece_name.upper()

        if piece_name == 'PAWN':
            return [['0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','1','2','2','2','2','1','0','0','0','0','0'],
                    ['0','0','0','0','0','1','2','2','2','2','1','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','1','1','2','2','1','1','0','0','0','0','0'],
                    ['0','0','0','0','1','1','2','2','2','2','1','1','0','0','0','0'],
                    ['0','0','0','1','1','2','2','2','2','2','2','1','1','0','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','0','1','1','1','1','1','1','1','1','1','1','0','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','0','1','1','1','1','1','1','1','1','1','1','0','0','0'],
                    ]
        elif piece_name == 'ROOK':
            return [['0','0','1','1','1','0','1','1','1','1','0','1','1','1','0','0'],
                    ['0','0','1','2','1','1','1','2','2','1','1','1','2','1','0','0'],
                    ['0','0','1','2','2','2','2','2','2','2','2','2','2','1','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','0','1','1','2','2','2','2','2','2','1','1','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','1','1','2','2','2','2','2','2','1','1','0','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ['0','0','1','2','2','2','2','2','2','2','2','2','2','1','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ]
        elif piece_name == 'KNIGHT':
            return [['0','0','0','0','1','1','1','0','0','1','1','1','0','0','0','0'],
                    ['0','0','0','0','1','2','1','1','1','1','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','1','1','0','0','0'],
                    ['0','0','1','2','2','1','2','2','2','2','2','2','1','0','0','0'],
                    ['0','1','2','2','2','2','2','2','2','2','2','2','1','1','0','0'],
                    ['0','1','1','2','2','1','1','2','2','2','2','2','2','1','0','0'],
                    ['0','1','2','2','1','0','1','2','2','2','2','2','2','1','0','0'],
                    ['0','0','1','1','0','0','1','2','2','2','2','2','2','1','0','0'],
                    ['0','0','0','0','0','1','1','2','2','2','2','2','2','1','0','0'],
                    ['0','0','0','0','1','1','2','2','2','2','2','2','1','1','0','0'],
                    ['0','0','0','1','1','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ['0','0','1','2','2','2','2','2','2','2','2','2','2','1','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ]
        elif piece_name == 'BISHOP':
            return [['0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','1','2','2','2','2','1','0','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','1','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','1','2','2','1','0','0','0','0'],
                    ['0','0','0','0','0','1','2','2','2','2','1','0','0','0','0','0'],
                    ['0','0','0','0','0','0','1','2','2','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','1','1','1','1','1','1','0','0','0','0','0'],
                    ['0','0','0','0','1','1','2','2','2','2','1','1','0','0','0','0'],
                    ['0','0','0','1','1','1','2','2','2','2','1','1','1','0','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ['0','0','1','2','2','2','2','2','2','2','2','2','2','1','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ]
        elif piece_name == 'QUEEN':
            return [['0','0','0','0','0','0','1','1','1','1','0','0','0','0','0','0'],
                    ['0','1','1','0','0','0','1','2','2','1','0','0','0','1','1','0'],
                    ['0','1','2','1','0','1','1','2','2','1','1','0','1','2','1','0'],
                    ['0','1','2','2','1','1','2','2','2','2','1','1','2','2','1','0'],
                    ['0','1','2','2','2','2','2','2','2','1','2','2','2','2','1','0'],
                    ['0','1','1','2','2','2','2','2','2','2','1','2','2','1','1','0'],
                    ['0','0','1','1','2','2','2','2','2','2','2','2','1','1','0','0'],
                    ['0','0','0','1','1','2','2','2','2','2','2','1','1','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','0','1','2','2','2','2','2','2','1','0','0','0','0'],
                    ['0','0','0','1','1','1','1','1','1','1','1','1','1','0','0','0'],
                    ['0','0','1','1','2','2','2','2','2','2','2','2','1','1','0','0'],
                    ['0','0','1','2','2','2','2','2','2','2','2','2','2','1','0','0'],
                    ['0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0'],
                    ['0','1','2','2','2','2','2','2','2','2','2','2','2','2','1','0'],
                    ['0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0'],
                    ]
        elif piece_name == 'KING':
            return [['0','0','0','0','0','0','1','1','1','1','0','0','0','0','0','0'],
                    ['0','0','0','0','0','1','1','2','2','1','1','0','0','0','0','0'],
                    ['0','0','0','0','0','1','2','1','1','2','1','0','0','0','0','0'],
                    ['0','0','1','1','1','1','2','1','1','2','1','1','1','1','0','0'],
                    ['0','1','2','2','2','1','1','2','2','1','1','2','2','2','1','0'],
                    ['1','2','1','1','1','2','1','1','1','1','2','1','1','1','2','1'],
                    ['1','2','1','1','1','1','2','2','2','2','1','1','1','1','2','1'],
                    ['1','1','1','1','1','1','1','2','2','1','1','1','2','1','1','1'],
                    ['1','1','1','1','1','1','1','2','2','1','1','2','1','1','1','1'],
                    ['0','1','1','1','1','1','1','2','2','1','1','1','1','1','1','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ['0','0','0','1','2','2','2','2','2','2','2','2','1','0','0','0'],
                    ['0','0','1','1','1','1','1','1','1','1','1','1','1','1','0','0'],
                    ['0','1','1','2','2','2','2','2','2','2','2','2','2','1','1','0'],
                    ['0','1','2','2','2','2','2','2','2','2','2','2','2','2','1','0'],
                    ['0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','0'],
                    ]
        else:
            return [['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ['0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'],
                    ]
        
    def __str__(self):
        return f'Piece: {self.piece_name}\nPrimary Color: {self.primary_color}\nPosition: ({self.row}, {self.column})'